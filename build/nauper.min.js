"use strict";var Nauper={version:"0.1"};
"use strict";var wrapText=function(e,t,r,n){var i=document.createElement("p"),u=t.split(" "),o="",s=0,d=0,a=[];return i.style.font=r,i.style.position="relative",i.style.zIndex="-1",i.innerHTML="Test",document.body.appendChild(i),s=i.offsetHeight,document.body.removeChild(i),u.forEach(function(t,r){d=""===o?e.render.measureText(t).width:e.render.measureText(o+" "+t).width,d>n?(a.push(o),o=t):d===n?(a.push(o+" "+t),o=""):d<n&&(o=o?o+" "+t:t,r+1===u.length&&a.push(o))}),{result:a,height:s}},getTextOffset=function(e,t){var r=e.render.measureText(t).width,n=.5*e.size.width,i=.5*r,u=n-i;return u},putDefaults=function(e,t){var r=Object.getOwnPropertyNames(e),n={};return r.forEach(function(r){void 0===t[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r])}),n};
"use strict";Nauper.UI=function(e){this.engine=e,this.canvas=this.engine.canvas,this.render=this.engine.render,this.size=this.engine.size},Nauper.UI.prototype.setBackground=function(e){e&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+e+")")},Nauper.UI.prototype.drawTextBox=function(e){var t={type:"default",color:"#fff",x:.025,y:.8,height:.18,width:.95,radius:.05},i=putDefaults(t,e),r=this.size.width*i.x,n=this.size.height*i.y,s=this.size.height*i.height,h=this.size.width*i.width,a=this.size.height*i.radius;this.render.fillStyle=i.color,"default"===i.type?this.render.fillRect(r,n,h,s):"rounded"===i.type&&(this.render.beginPath(),this.render.moveTo(r,n+a),this.render.lineTo(r,n+s-a),this.render.quadraticCurveTo(r,n+s,r+a,n+s),this.render.lineTo(r+h-a,n+s),this.render.quadraticCurveTo(r+h,n+s,r+h,n+s-a),this.render.lineTo(r+h,n+a),this.render.quadraticCurveTo(r+h,n,r+h-a,n),this.render.lineTo(r+a,n),this.render.quadraticCurveTo(r,n,r,n+a),this.render.fill())},Nauper.UI.prototype.drawText=function(e){var t=this,i={text:"",align:"wrapped",color:"#000",x:.1,y:.85,width:.8},r=putDefaults(i,e),n=this.size.width*r.x,s=this.size.height*r.y,h=this.size.width*r.width;if(this.render.fillStyle=r.color,"wrapped"===r.align)!function(){var e=wrapText(t.engine,r.text,t.render.font,h);e.result.forEach(function(i,r){t.render.fillText(i,n,s+e.height*r)})}();else if("center"===r.align){var a=getTextOffset(this.engine,r.text);this.render.fillText(r.text,a,s)}};
"use strict";Nauper.Engine=function(e){function t(e){this.clickType&&this[this.clickType].call(this,e)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.ui=new Nauper.UI(this),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=e.font,this.elements=i,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.elements[this.globalIndex][this.localIndex].map[i].address!==!1&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=-1),this.nextElement())},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(t,e){this.engine=t,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=e.characters,this.displayOrder=e.displayOrder,this.background=e.background,this.text=e.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.setText=function(){this.engine.ui.drawTextBox({type:this.text.edges,color:this.text.base}),this.engine.ui.drawText({text:this.text.name,color:this.text.namecolor,x:.1,y:.83}),this.engine.ui.drawText({text:this.text.text,color:this.text.textcolor,x:.1,y:.855})},Nauper.Frame.prototype.displayCharacters=function(){var t=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){var e=t.displayOrder.length;t.displayOrder.forEach(function(i,r){i!==!1&&void 0!==i?!function(){var s=new Image;s.addEventListener("load",function(){var i=1.2*t.size.height/s.height,h=.1*t.size.height,n=t.size.width*(.225*r);t.render.drawImage(s,n,h,s.width*i,s.height*i),e-=1,0===e&&t.setText()}),s.src=t.characters[i]}():e-=1})}():this.setText()};
"use strict";Nauper.Question=function(e,t){this.background=t.background,this.activebox=t.textbox.active,this.inactivebox=t.textbox.inactive,this.boxtype=t.textbox.type,this.necessary=t.necessary,this.engine=e,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=t.map,this.setType(),this.draw=function(){var e=this;0!==this.map.length&&this.map.length<=4?!function(){var t=.025,i=0,n=.2,s=.95,a=.05;e.render.clearRect(0,0,e.size.width,e.size.height),e.engine.ui.setBackground(e.background),e.map.forEach(function(h,c){i=.25*c+.025,e.engine.ui.drawTextBox({type:e.boxtype,color:e.inactivebox.background,y:i,x:t,height:n,width:s,radius:a}),e.engine.ui.drawText({text:h.text,align:"center",color:e.inactivebox.text,y:i+.1})})}():this.engine.nextElement()}.bind(this)},Nauper.Question.prototype.setType=function(){this.necessary===!0||void 0===this.necessary?this.type="choice":this.type="frame"};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};