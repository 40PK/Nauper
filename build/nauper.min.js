"use strict";var Nauper={version:"0.1"};
"use strict";var wrapText=function(e,t,r,n){var i=document.createElement("p"),u=t.split(" "),o="",s=0,d=0,a=[];return i.style.font=r,i.style.position="relative",i.style.zIndex="-1",i.innerHTML="Test",document.body.appendChild(i),s=i.offsetHeight,document.body.removeChild(i),u.forEach(function(t,r){d=""===o?e.render.measureText(t).width:e.render.measureText(o+" "+t).width,d>n?(a.push(o),o=t):d===n?(a.push(o+" "+t),o=""):d<n&&(o=o?o+" "+t:t,r+1===u.length&&a.push(o))}),{result:a,height:s}},getTextOffset=function(e,t){var r=e.render.measureText(t).width,n=.5*e.size.width,i=.5*r,u=n-i;return u},putDefaults=function(e,t){var r=Object.getOwnPropertyNames(e),n={};return r.forEach(function(r){void 0===t[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r])}),n};
"use strict";Nauper.UI=function(e){this.engine=e,this.canvas=this.engine.canvas,this.render=this.engine.render,this.size=this.engine.size},Nauper.UI.prototype.setBackground=function(e){e&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+e+")")},Nauper.UI.prototype.drawTextBox=function(e){var t={type:"default",color:"#fff",abs:.025,ord:.8,h:.18,w:.95,r:.05},i=putDefaults(t,e),r=this.size.width*i.abs,s=this.size.height*i.ord,n=this.size.height*i.h,h=this.size.width*i.w,a=this.size.height*i.r;this.render.fillStyle=i.color,"default"===i.type?this.render.fillRect(r,s,h,n):"rounded"===i.type&&(this.render.beginPath(),this.render.moveTo(r,s+a),this.render.lineTo(r,s+n-a),this.render.quadraticCurveTo(r,s+n,r+a,s+n),this.render.lineTo(r+h-a,s+n),this.render.quadraticCurveTo(r+h,s+n,r+h,s+n-a),this.render.lineTo(r+h,s+a),this.render.quadraticCurveTo(r+h,s,r+h-a,s),this.render.lineTo(r+a,s),this.render.quadraticCurveTo(r,s,r,s+a),this.render.fill())},Nauper.UI.prototype.drawText=function(e){var t=this,i={text:"",align:"wrapped",color:"#000",abs:.1,ord:.85,width:.8},r=putDefaults(i,e),s=this.size.width*r.abs,n=this.size.height*r.ord,h=this.size.width*r.width;if(this.render.fillStyle=r.color,"wrapped"===r.align)!function(){var e=wrapText(t.engine,r.text,t.render.font,h);e.result.forEach(function(i,r){t.render.fillText(i,s,n+e.height*r)})}();else if("center"===r.align){var a=getTextOffset(this.engine,r.text);this.render.fillText(r.text,a,n)}};
"use strict";Nauper.Engine=function(e){function t(e){this.clickType&&this[this.clickType].call(this,e)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.ui=new Nauper.UI(this),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=e.font,this.elements=i,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(e,t){this.engine=e,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=t.characters,this.displayOrder=t.displayOrder,this.background=t.background,this.text=t.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.displayCharacters=function(){var e=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){var t=e.displayOrder.length;e.displayOrder.forEach(function(i,r){i!==!1&&void 0!==i?!function(){var s=new Image;s.addEventListener("load",function(){var i=1.2*e.size.height/s.height,n=.1*e.size.height,a=e.size.width*(.225*r);e.render.drawImage(s,a,n,s.width*i,s.height*i),t-=1,0===t&&(e.engine.ui.drawTextBox({type:e.text.edges}),e.engine.ui.drawText({text:e.text.name,abs:.1,ord:.82}),e.engine.ui.drawText({text:e.text.text,abs:.1,ord:.845}))}),s.src=e.characters[i]}():t-=1})}():this.setText()};
"use strict";Nauper.Question=function(e,t){this.background=t.background,this.activebox=t.textbox.active,this.inactivebox=t.textbox.inactive,this.boxtype=t.textbox.type,this.necessary=t.necessary,this.engine=e,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=t.map,this.setType(),this.draw=function(){var e=this;0!==this.map.length&&this.map.length<=4?!function(){var t=.025,i=0,n=.2,s=.95,a=.05;e.render.clearRect(0,0,e.size.width,e.size.height),e.engine.ui.setBackground(e.background),e.map.forEach(function(o,r){i=.25*r+.025,e.engine.ui.drawTextBox({type:e.boxtype,color:e.inactivebox.background,ord:i,abs:t,h:n,w:s,r:a}),e.engine.ui.drawText({text:o.text,align:"center",color:e.inactivebox.text,ord:i+.1})})}():this.engine.nextElement()}.bind(this)},Nauper.Question.prototype.setType=function(){this.necessary===!0||void 0===this.necessary?this.type="choice":this.type="frame"};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};