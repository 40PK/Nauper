var Nauper={version:"0.1"};
Nauper.Engine=function(e,t){function i(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",i.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0};
Nauper.Frame=function(e){var t=e.characters,i=e.displayOrder,a=e.textbox;if(!a)throw new Error;this.type="frame",this.draw=function(r){function h(){var e=.025*d.width,t=.8*d.height,i=.18*d.height,r=.95*d.width,h=.05*d.height;o.fillStyle=a.base,"default"===a.edges?o.fillRect(0,.8*d.height,d.width,.2*d.height):"rounded"===a.edges&&(o.beginPath(),o.moveTo(e,t+h),o.lineTo(e,t+i-h),o.quadraticCurveTo(e,t+i,e+h,t+i),o.lineTo(e+r-h,t+i),o.quadraticCurveTo(e+r,t+i,e+r,t+i-h),o.lineTo(e+r,t+h),o.quadraticCurveTo(e+r,t,e+r-h,t),o.lineTo(e+h,t),o.quadraticCurveTo(e,t,e,t+h),o.fill()),o.fillStyle=a.namecolor,o.font="15pt Arial",o.fillText(a.name,.1*d.width,.8*d.height+27),o.fillStyle=a.textcolor,o.fillText(a.text,.1*d.width,.83*d.height+27)}var o=r.render,d=r.size,l=r.canvas;o.clearRect(0,0,d.width,d.height),e.background&&(l.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")",l.style.backgroundSize="cover"),i.forEach(function(e,i){var a;e===!1&&0!==e||(a=new Image,a.onload=function(){var e,t=1.2*d.height/a.height,r=.1*d.height;0===i?e=0:1===i?e=.225*d.width:2===i?e=.45*d.width:3===i&&(e=.675*d.width),o.drawImage(a,e,r,a.width*t,a.height*t),h()},a.src=t[e])})}};
Nauper.Character=function(r){var n={};if(r.path&&0!==r.emotions.length)return r.emotions.forEach(function(t){n[t]=r.path+"/"+t+".png"}),n;throw new Error};
Nauper.Question=function(t){var i=t.background,e=t.boxcolor,h=t.textcolor,a=t.boxtype;if(this.map=t.map,!(this.map.length>1&&this.map.length<5&&e&&h))throw new Error;this.type="choice",this.draw=function(t){var o=t.render,r=t.canvas,l=t.size,n=.025*l.width,c=0,d=.2*l.height,u=.95*l.width,g=.05*l.height;o.clearRect(0,0,l.width,l.height),i&&(r.style.backgroundImage='url("./data/images/backgrounds/'+i+'")'),this.map.forEach(function(t,i){o.fillStyle=e,c=0===i?.05*l.height:.3*i*l.height,"default"===a?o.fillRect(0,.25*i*l.height,l.width,.25*l.height):"rounded"===a&&(o.beginPath(),o.moveTo(n,c+g),o.lineTo(n,c+d-g),o.quadraticCurveTo(n,c+d,n+g,c+d),o.lineTo(n+u-g,c+d),o.quadraticCurveTo(n+u,c+d,n+u,c+d-g),o.lineTo(n+u,c+g),o.quadraticCurveTo(n+u,c,n+u-g,c),o.lineTo(n+g,c),o.quadraticCurveTo(n,c,n,c+g),o.fill()),o.fillStyle=h,o.fillText(t.text,.5*l.width,l.height*(c/l.height+.1))})}.bind(this)};