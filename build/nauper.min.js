function Engine(n){if(0==n.length)throw new Error;render_=function(r){n.forEach(function(n,e,t){e==r&&("scene"==n.type?(n.start(),r++):"question"==n.type&&render_(n.draw()))})},this.start=function(){return render_(0),!0}}
function Scene(e){if(0==e.frames.length)throw new Error;frames=e.frames,currentFrame=-1,this.type="scene",this.drawing=!1,nextFrame=function(){currentFrame!=frames.length-1||currentFrame==-1?(currentFrame+=1,frames[currentFrame].draw()):(canvas.removeEventListener("click",nextFrame),frames[currentFrame].draw(),drawing=!1)},this.start=function(){this.drawing=!0,canvas.addEventListener("click",nextFrame)}}
function Frame(e){function i(){render.fillStyle=a.base,render.fillRect(0,.8*size.height,size.width,.2*size.height),render.fillStyle=a.namecolor,render.font="15pt Arial",render.fillText(a.name,.1*size.width,.82*size.height),render.fillStyle=a.textcolor,render.fillText(a.text,.1*size.width,.85*size.height)}if(0==e.characters.length||0==e.displayOrder.length||!e.textbox||!e.background)throw new Error;var r=e.characters,t=e.displayOrder,a=e.textbox;this.draw=function(){render.clearRect(0,0,size.width,size.height),canvas.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")",canvas.style.backgroundSize="cover";t.forEach(function(e,t,a){if(0!=e||0==e){var n=new Image;n.onload=function(){var e=1.2*size.height/n.height,r=.1*size.height;if(0==t)var a=0;else if(1==t)var a=.225*size.width;else if(2==t)var a=.45*size.width;else if(3==t)var a=.675*size.width;render.drawImage(n,a,r,n.width*e,n.height*e),i()},n.src=r[e]}})}}
function Character(n){if(n.path&&0!=n.emotions.length){var r={};return n.emotions.forEach(function(t,o,a){r[t]=n.path+"/"+t+".png"}),r}throw new Error}
function Question(e){if(!(0!=e.map.length&&1!=e.map.length&&e.map.length<5&&e.background&&e.boxcolor&&e.textcolor))throw new Error;this.map=e.map,this.background=e.background,this.boxcolor=e.boxcolor,this.type="choice",this.textcolor=e.textcolor,this.draw=function(){render.fillStyle=this.background,render.fillRect(0,0,size.width,size.height),this.map.forEach(function(e,t,i){render.fillStyle=this.boxcolor,render.fillRect(0,.25*t*size.height,size.width,.25*size.height),render.fillStyle=this.textcolor,render.fillText(e.text,.5*size.width,.25*t*size.height+.01)});var e=!1;for(this.checkClick=function(t){var i=(t.pageX,t.pageY),h=0;i<.25*size.height?h=0:i<.5*size.height?h=1:i<.75*size.height?h=2:i<size.height&&(h=3),h<this.map.length&&(canvas.removeEventListener("click"),e=h)},canvas.addEventListener("click",this.checkClick);0==e;);return e}}