var Nauper={version:"0.1"};
Nauper.Engine=function(e,i){function t(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=i,this.index=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var i=e.pageY,t=3;i<.25*this.size.height?t=0:i<.5*this.size.height?t=1:i<.75*this.size.height&&(t=2),t<this.elements[this.index].map.length&&(this.index=this.elements[this.index].map[t].address,this.clickType="nextElement",this.elements[this.index].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.index=Number(this.index)+1,this.index===this.elements.length?this.clickType=null:(this.elements[this.index].draw.call(null,this),this.clickType="choice"===this.elements[this.index].type?"choice":this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0].type?this.clickType="nextElement":"choice"===this.elements[1].type&&(this.clickType="choice"),this.elements[0].draw.call(null,this),!0};
Nauper.Frame=function(t){if(0===t.characters.length||0===t.displayOrder.length||!t.textbox||!t.background)throw new Error;var e=t.characters,i=t.displayOrder,r=t.textbox;this.type="frame",this.draw=function(a){function h(){l.fillStyle=r.base,l.fillRect(0,.8*n.height,n.width,.2*n.height),l.fillStyle=r.namecolor,l.font="15pt Arial",l.fillText(r.name,.1*n.width,.82*n.height),l.fillStyle=r.textcolor,l.fillText(r.text,.1*n.width,.85*n.height)}var l=a.render,n=a.size,c=a.canvas;l.clearRect(0,0,n.width,n.height),c.style.backgroundImage="url(./data/images/backgrounds/"+t.background+")",c.style.backgroundSize="cover",i.forEach(function(t,i){if(t!==!1||0===t){var r=new Image;r.onload=function(){var t,e=1.2*n.height/r.height,a=.1*n.height;0===i?t=0:1===i?t=.225*n.width:2===i?t=.45*n.width:3===i&&(t=.675*n.width),l.drawImage(r,t,a,r.width*e,r.height*e),h()},r.src=e[t]}})}};
Nauper.Character=function(r){if(r.path&&0!==r.emotions.length){var n={};return r.emotions.forEach(function(t){n[t]=r.path+"/"+t+".png"}),n}throw new Error};
Nauper.Question=function(t){if(!(0!==t.map.length&&1!==t.map.length&&t.map.length<5&&t.background&&t.boxcolor&&t.textcolor))throw new Error;this.map=t.map;var i=t.background,e=t.boxcolor;this.type="choice";var h=t.textcolor;this.draw=function(t){var l=t.render,o=t.size;l.fillStyle=i,l.fillRect(0,0,o.width,o.height),this.map.forEach(function(t,i){l.fillStyle=e,l.fillRect(0,.25*i*o.height,o.width,.25*o.height),l.fillStyle=h,l.fillText(t.text,.5*o.width,o.height*(.25*i+.125))})}.bind(this)};