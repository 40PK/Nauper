"use strict";var Nauper={version:"0.1"};
"use strict";var wrapText=function(e,t,n,r){var s=document.createElement("p"),i=t.split(" "),d="",o=0,u=0,h=[];return s.style.font=n,s.style.position="relative",s.style.zIndex="-1",s.innerHTML="Test",document.body.appendChild(s),o=s.offsetHeight,document.body.removeChild(s),i.forEach(function(t,n){u=""===d?e.render.measureText(t).width:e.render.measureText(d+" "+t).width,u>r?(h.push(d),d=t):u===r?(h.push(d+" "+t),d=""):u<r&&(d=d?d+" "+t:t,n+1===i.length&&h.push(d))}),{result:h,height:o}};
"use strict";Nauper.Engine=function(e,t){function i(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",i.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(t,e){var i=e.characters,h=e.displayOrder,n=e.textbox,a=t.render,r=t.size,o=t.canvas,c=function(){var e=.025*r.width,i=.8*r.height,h=.18*r.height,o=.95*r.width,c=.05*r.height,d=[];a.fillStyle=n.base,"default"===n.edges?a.fillRect(0,.8*r.height,r.width,.2*r.height):"rounded"===n.edges&&(a.beginPath(),a.moveTo(e,i+c),a.lineTo(e,i+h-c),a.quadraticCurveTo(e,i+h,e+c,i+h),a.lineTo(e+o-c,i+h),a.quadraticCurveTo(e+o,i+h,e+o,i+h-c),a.lineTo(e+o,i+c),a.quadraticCurveTo(e+o,i,e+o-c,i),a.lineTo(e+c,i),a.quadraticCurveTo(e,i,e,i+c),a.fill()),a.fillStyle=n.namecolor,a.font="15pt Arial",a.fillText(n.name,.1*r.width,.8*r.height+27),a.fillStyle=n.textcolor,d=wrapText(t,n.text,a.font,.8*r.width),d.result.forEach(function(t,e){a.fillText(t,.1*r.width,.83*r.height+27+d.height*e)})},d=function(){e.background&&(o.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")")},l=function(){void 0!==h&&0!==h.length?!function(){var t=h.length;h.forEach(function(e,h){e!==!1&&void 0!==e?!function(){var n=new Image;n.addEventListener("load",function(){var e=1.2*r.height/n.height,i=.1*r.height,o=r.width*(.225*h);a.drawImage(n,o,i,n.width*e,n.height*e),t-=1,0===t&&c()}),n.src=i[e]}():t-=1})}():c()};this.type="frame",this.check=function(){return!0},this.draw=function(){this.check()?(a.clearRect(0,0,r.width,r.height),d(),l()):t.nextElement()}.bind(this)};
"use strict";Nauper.Question=function(t,i){var e=this,h=i.background,a=i.textbox.active,d=i.textbox.inactive,r=i.textbox.type,u=i.necessary,n=t.render,o=t.canvas,l=t.size,s=function(){h&&(o.style.backgroundImage='url("./data/images/backgrounds/'+h+'")')},x=function(){u===!0||void 0===u?e.type="choice":e.type="frame"},c=function(t,i,h){var r=.5*l.width-n.measureText(e.map[t].text).width/2,u=l.height*(h.y/l.height+.1);i?n.fillStyle=a.text:i||(n.fillStyle=d.text),n.fillText(e.map[t].text,r,u)},y=function(t,i,e){i?n.fillStyle=a.background:i||(n.fillStyle=d.background),"default"===r?n.fillRect(e.x,e.y,e.width,e.height):"rounded"===r&&(n.beginPath(),n.moveTo(e.x,e.y+e.radius),n.lineTo(e.x,e.y+e.height-e.radius),n.quadraticCurveTo(e.x,e.y+e.height,e.x+e.radius,e.y+e.height),n.lineTo(e.x+e.width-e.radius,e.y+e.height),n.quadraticCurveTo(e.x+e.width,e.y+e.height,e.x+e.width,e.y+e.height-e.radius),n.lineTo(e.x+e.width,e.y+e.radius),n.quadraticCurveTo(e.x+e.width,e.y,e.x+e.width-e.radius,e.y),n.lineTo(e.x+e.radius,e.y),n.quadraticCurveTo(e.x,e.y,e.x,e.y+e.radius),n.fill()),c(t,i,e)};this.map=i.map,this.map.length>1&&this.map.length<5?(x(),this.draw=function(){var t=.025*l.width,i=0,e=.2*l.height,h=.95*l.width,a=.05*l.height;n.clearRect(0,0,l.width,l.height),s(),this.map.forEach(function(d,r){i=(.25*r+.025)*l.height,y(r,!1,{x:t,y:i,height:e,width:h,radius:a})})}.bind(this)):t.nextElement()};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};