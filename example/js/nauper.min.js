var Nauper={version:"0.1"};
Nauper.Engine=function(e,i){function t(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=i,this.index=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var i=e.pageY,t=3;i<.25*this.size.height?t=0:i<.5*this.size.height?t=1:i<.75*this.size.height&&(t=2),t<this.elements[this.index].map.length&&(this.index=this.elements[this.index].map[t].address,this.clickType="nextElement",this.elements[this.index].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.index=Number(this.index)+1,this.index===this.elements.length?this.clickType=null:(this.elements[this.index].draw.call(null,this),this.clickType="choice"===this.elements[this.index].type?"choice":this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0].type?this.clickType="nextElement":"choice"===this.elements[1].type&&(this.clickType="choice"),this.elements[0].draw.call(null,this),!0};
Nauper.Frame=function(t){var e=t.characters,i=t.displayOrder,h=t.textbox;if(0===e.length||0===i.length||!h||!t.background)throw new Error;this.type="frame",this.draw=function(a){function r(){l.fillStyle=h.base,l.fillRect(0,.8*n.height,n.width,.2*n.height),l.fillStyle=h.namecolor,l.font="15pt Arial",l.fillText(h.name,.1*n.width,.82*n.height),l.fillStyle=h.textcolor,l.fillText(h.text,.1*n.width,.85*n.height)}var l=a.render,n=a.size,o=a.canvas;l.clearRect(0,0,n.width,n.height),o.style.backgroundImage="url(./data/images/backgrounds/"+t.background+")",o.style.backgroundSize="cover",i.forEach(function(t,i){var h;t===!1&&0!==t||(h=new Image,h.onload=function(){var t,e=1.2*n.height/h.height,a=.1*n.height;0===i?t=0:1===i?t=.225*n.width:2===i?t=.45*n.width:3===i&&(t=.675*n.width),l.drawImage(h,t,a,h.width*e,h.height*e),r()},h.src=e[t])})}};
Nauper.Character=function(r){var n={};if(r.path&&0!==r.emotions.length)return r.emotions.forEach(function(t){n[t]=r.path+"/"+t+".png"}),n;throw new Error};
Nauper.Question=function(t){var i=t.background,h=t.boxcolor,e=t.textcolor;if(this.map=t.map,!(this.map.length>1&&this.map.length<5&&i&&h&&e))throw new Error;this.type="choice",this.draw=function(t){var l=t.render,o=t.size;l.fillStyle=i,l.fillRect(0,0,o.width,o.height),this.map.forEach(function(t,i){l.fillStyle=h,l.fillRect(0,.25*i*o.height,o.width,.25*o.height),l.fillStyle=e,l.fillText(t.text,.5*o.width,o.height*(.25*i+.125))})}.bind(this)};