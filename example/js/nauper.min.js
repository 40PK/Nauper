"use strict";var Nauper={version:"0.1"};
"use strict";var getTextHeight=function(t){var e=document.createElement("p"),n=0;return e.style.font=t,e.style.position="relative",e.style.zIndex="-1",e.innerHTML="Test",document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e),n},wrapText=function(t,e,n,r){var u=e.split(" "),i="",o=getTextHeight(n),s=0,a=[];return u.forEach(function(e,n){s=""===i?t.measureText(e).width:t.measureText(i+" "+e).width,s>r?(a.push(i),i=e):s===r?(a.push(i+" "+e),i=""):s<r&&(i=i?i+" "+e:e,n+1===u.length&&a.push(i))}),{result:a,height:o}},getTextOffset=function(t,e,n){var r=t.measureText(n).width,u=.5*e.width,i=.5*r,o=u-i;return o},putDefaults=function(t,e){var n=Object.getOwnPropertyNames(t),r={};return n.forEach(function(n){void 0===e[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])}),r},copyObject=function(t){var e={};return e=putDefaults(t,{})};
"use strict";Nauper.UI=function(e){this.engine=e,this.canvas=this.engine.canvas,this.offscreen=this.engine.offscreen,this.render=this.engine.render,this.offrender=this.engine.offrender,this.size=this.engine.size},Nauper.UI.prototype.setBackground=function(e){e&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+e+")")},Nauper.UI.prototype.drawTextBox=function(e){var t={type:"default",color:"#fff",link:"",x:.025,y:.8,height:.18,width:.95,radius:.05,render:this.render,canvas:this.canvas,expand:{}},i=putDefaults(t,e),r=this.size.width*i.x,n=this.size.height*i.y,s=this.size.height*i.height,h=this.size.width*i.width,a=this.size.height*i.radius;i.render.fillStyle=i.color,"default"===i.type?i.render.fillRect(r,n,h,s):"rounded"===i.type?(i.render.beginPath(),i.render.moveTo(r,n+a),i.render.lineTo(r,n+s-a),i.render.quadraticCurveTo(r,n+s,r+a,n+s),i.render.lineTo(r+h-a,n+s),i.render.quadraticCurveTo(r+h,n+s,r+h,n+s-a),i.render.lineTo(r+h,n+a),i.render.quadraticCurveTo(r+h,n,r+h-a,n),i.render.lineTo(r+a,n),i.render.quadraticCurveTo(r,n,r,n+a),i.render.fill()):"image"===i.type&&!function(){var e=new Image;e.onload=function(){i.render.drawImage(e,r,n,h,s),i.onimageload&&i.onimageload()},e.src=i.link}()},Nauper.UI.prototype.drawText=function(e){var t={text:"",align:"wrapped",color:"#000",x:.1,y:.85,width:.8,render:this.render,canvas:this.canvas},i=putDefaults(t,e),r=this.size.width*i.x,n=this.size.height*i.y,s=this.size.width*i.width;if(i.render.fillStyle=i.color,"wrapped"===i.align)!function(){var e=wrapText(i.render,i.text,i.render.font,s);e.result.forEach(function(t,s){i.render.fillText(t,r,n+e.height*s)})}();else if("center"===i.align){var h=getTextOffset(i.render,{width:i.canvas.width},i.text);i.render.fillText(i.text,h,n)}},Nauper.UI.prototype.drawTextWithBox=function(e){var t={type:"default",color:"#fff",link:"",x:.025,y:.8,height:.18,width:.95,radius:.05,render:this.offrender,canvas:this.offscreen},i={text:"",align:"center",color:"#000",x:.1,y:.85,width:.8,render:this.offrender,canvas:this.offscreen},r=putDefaults(t,e.box),n=putDefaults(i,e.text),s={box:copyObject(r),text:copyObject(n)};s.text.x-=s.box.x,s.text.y-=s.box.y,s.box.x=0,s.box.y=0,this.offscreen.width=r.width*this.size.width,this.offscreen.height=r.height*this.size.height,this.offrender.font=this.render.font,this.drawTextBox(s.box),this.drawText(s.text),this.render.drawImage(this.offscreen,r.x*this.size.width,r.y*this.size.height)};
"use strict";Nauper.Engine=function(e){function t(e){this.clickType&&this[this.clickType].call(this,e)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.font=e.font,this.canvas=e.canvas,this.offscreen=e.offscreen,this.render=this.canvas.getContext("2d"),this.offrender=this.offscreen.getContext("2d"),this.size=e.size,this.ui=new Nauper.UI(this),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=this.font,this.elements=i,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.elements[this.globalIndex][this.localIndex].map[i].address!==!1&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=-1),this.nextElement())},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType="nextElement")},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(t,e){this.engine=t,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=e.characters,this.displayOrder=e.displayOrder,this.background=e.background,this.text=e.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.setText=function(){void 0!==this.text&&(this.engine.ui.drawTextBox({type:this.text.edges,color:this.text.base}),this.engine.ui.drawText({text:this.text.name,color:this.text.namecolor,x:.1,y:.83}),this.engine.ui.drawText({text:this.text.text,color:this.text.textcolor,x:.1,y:.855}))},Nauper.Frame.prototype.displayCharacters=function(){var t=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){var e=t.displayOrder.length;t.displayOrder.forEach(function(i,s){i!==!1&&void 0!==i?!function(){var r=new Image;r.addEventListener("load",function(){var i=1.2*t.size.height/r.height,h=.1*t.size.height,n=t.size.width*(.225*s);t.render.drawImage(r,n,h,r.width*i,r.height*i),e-=1,0===e&&t.setText()}),r.src=t.characters[i]}():e-=1})}():this.setText()};
"use strict";Nauper.Question=function(e,t){this.background=t.background,this.activebox=t.textbox.active,this.inactivebox=t.textbox.inactive,this.boxtype=t.textbox.type,this.boxlink=t.textbox.link,this.necessary=t.necessary,this.engine=e,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=t.map,this.setType(),this.draw=function(){var e=this;0!==this.map.length&&this.map.length<=4?!function(){var t=.025,i=0,n=.2,s=.95,a=.05;e.render.clearRect(0,0,e.size.width,e.size.height),e.engine.ui.setBackground(e.background),e.map.forEach(function(h,o){i=.25*o+.025,e.engine.ui.drawTextBox({type:e.boxtype,color:e.inactivebox.background,link:e.boxlink,source:e,y:i,x:t,height:n,width:s,radius:a}),e.engine.ui.drawText({text:h.text,align:"center",color:e.inactivebox.text,y:i+.1})})}():this.engine.nextElement()}.bind(this)},Nauper.Question.prototype.setType=function(){this.necessary===!0||void 0===this.necessary?this.type="choice":this.type="frame"};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};