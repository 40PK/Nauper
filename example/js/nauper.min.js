"use strict";var wrapText=function(e,t,n,r){var s=document.createElement("p"),i=t.split(" "),d="",o=0,u=0,h=[];return s.style.font=n,s.style.position="relative",s.style.zIndex="-1",s.innerHTML="Test",document.body.appendChild(s),o=s.offsetHeight,document.body.removeChild(s),i.forEach(function(t,n){u=""===d?e.render.measureText(t).width:e.render.measureText(d+" "+t).width,u>r?(h.push(d),d=t):u===r?(h.push(d+" "+t),d=""):u<r&&(d=d?d+" "+t:t,n+1===i.length&&h.push(d))}),{result:h,height:o}};
"use strict";var Nauper={version:"0.1"};
"use strict";Nauper.Engine=function(e,t){function i(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",i.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(e,t){var i=t.characters,a=t.displayOrder,h=t.textbox,r=e.render,o=e.size,d=e.canvas,l=function(){var t=.025*o.width,i=.8*o.height,a=.18*o.height,d=.95*o.width,l=.05*o.height,n=[];r.fillStyle=h.base,"default"===h.edges?r.fillRect(0,.8*o.height,o.width,.2*o.height):"rounded"===h.edges&&(r.beginPath(),r.moveTo(t,i+l),r.lineTo(t,i+a-l),r.quadraticCurveTo(t,i+a,t+l,i+a),r.lineTo(t+d-l,i+a),r.quadraticCurveTo(t+d,i+a,t+d,i+a-l),r.lineTo(t+d,i+l),r.quadraticCurveTo(t+d,i,t+d-l,i),r.lineTo(t+l,i),r.quadraticCurveTo(t,i,t,i+l),r.fill()),r.fillStyle=h.namecolor,r.font="15pt Arial",r.fillText(h.name,.1*o.width,.8*o.height+27),r.fillStyle=h.textcolor,n=wrapText(e,h.text,r.font,.8*o.width),n.result.forEach(function(e,t){r.fillText(e,.1*o.width,.83*o.height+27+n.height*t)})};this.type="frame",this.draw=function(){r.clearRect(0,0,o.width,o.height),t.background&&(d.style.backgroundImage="url(./data/images/backgrounds/"+t.background+")",d.style.backgroundSize="cover"),a&&a.forEach(function(e,t){var a=void 0;e===!1&&0!==e||(a=new Image,a.onload=function(){var e=1.2*o.height/a.height,i=.1*o.height,h=void 0;0===t?h=0:1===t?h=.225*o.width:2===t?h=.45*o.width:3===t&&(h=.675*o.width),r.drawImage(a,h,i,a.width*e,a.height*e),l()},a.src=i[e])})}};
"use strict";Nauper.Character=function(r){var t={};if(r.path&&0!==r.emotions.length)return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t;throw new Error};
"use strict";Nauper.Question=function(t,e){var i=e.background,h=e.boxcolor,a=e.textcolor,r=e.boxtype,o=e.necessary,l=t.render,n=t.canvas,c=t.size;if(this.map=e.map,!(this.map.length>1&&this.map.length<5&&h&&a))throw new Error;o===!0||void 0===o?this.type="choice":o===!1&&(this.type="frame"),this.draw=function(){var t=.025*c.width,e=0,o=.2*c.height,d=.95*c.width,u=.05*c.height;l.clearRect(0,0,c.width,c.height),i&&(n.style.backgroundImage='url("./data/images/backgrounds/'+i+'")'),this.map.forEach(function(i,n){l.fillStyle=h,e=0===n?.05*c.height:.3*n*c.height,"default"===r?l.fillRect(0,.25*n*c.height,c.width,.25*c.height):"rounded"===r&&(l.beginPath(),l.moveTo(t,e+u),l.lineTo(t,e+o-u),l.quadraticCurveTo(t,e+o,t+u,e+o),l.lineTo(t+d-u,e+o),l.quadraticCurveTo(t+d,e+o,t+d,e+o-u),l.lineTo(t+d,e+u),l.quadraticCurveTo(t+d,e,t+d-u,e),l.lineTo(t+u,e),l.quadraticCurveTo(t,e,t,e+u),l.fill()),l.fillStyle=a,l.fillText(i.text,.5*c.width,c.height*(e/c.height+.1))})}.bind(this)};