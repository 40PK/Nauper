var Nauper={version:"0.1"};
Nauper.Engine=function(e,t){function i(e){this.clickType&&this[this.clickType].call(this,e)}this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",i.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0};
Nauper.Frame=function(e){var t=e.characters,i=e.displayOrder,a=e.textbox;if(0===t.length||0===i.length||!a||!e.background)throw new Error;this.type="frame",this.draw=function(h){function r(){var e=.025*o.width,t=.8*o.height,i=.18*o.height,h=.95*o.width,r=.05*o.height;l.fillStyle=a.base,"default"===a.edges?l.fillRect(0,.8*o.height,o.width,.2*o.height):"rounded"===a.edges&&(l.beginPath(),l.moveTo(e,t+r),l.lineTo(e,t+i-r),l.quadraticCurveTo(e,t+i,e+r,t+i),l.lineTo(e+h-r,t+i),l.quadraticCurveTo(e+h,t+i,e+h,t+i-r),l.lineTo(e+h,t+r),l.quadraticCurveTo(e+h,t,e+h-r,t),l.lineTo(e+r,t),l.quadraticCurveTo(e,t,e,t+r),l.fill()),l.fillStyle=a.namecolor,l.font="15pt Arial",l.fillText(a.name,.1*o.width,.8*o.height+27),l.fillStyle=a.textcolor,l.fillText(a.text,.1*o.width,.83*o.height+27)}var l=h.render,o=h.size,d=h.canvas;l.clearRect(0,0,o.width,o.height),d.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")",d.style.backgroundSize="cover",i.forEach(function(e,i){var a;e===!1&&0!==e||(a=new Image,a.onload=function(){var e,t=1.2*o.height/a.height,h=.1*o.height;0===i?e=0:1===i?e=.225*o.width:2===i?e=.45*o.width:3===i&&(e=.675*o.width),l.drawImage(a,e,h,a.width*t,a.height*t),r()},a.src=t[e])})}};
Nauper.Character=function(r){var n={};if(r.path&&0!==r.emotions.length)return r.emotions.forEach(function(t){n[t]=r.path+"/"+t+".png"}),n;throw new Error};
Nauper.Question=function(t){var i=t.background,e=t.boxcolor,h=t.textcolor,a=t.boxtype;if(this.map=t.map,!(this.map.length>1&&this.map.length<5&&i&&e&&h))throw new Error;this.type="choice",this.draw=function(t){var o=t.render,r=t.canvas,l=t.size,n=.025*l.width,c=0,d=.2*l.height,u=.95*l.width,g=.05*l.height;o.clearRect(0,0,l.width,l.height),r.style.backgroundImage='url("./data/images/backgrounds/'+i+'")',this.map.forEach(function(t,i){o.fillStyle=e,c=0===i?.05*l.height:.3*i*l.height,"default"===a?o.fillRect(0,.25*i*l.height,l.width,.25*l.height):"rounded"===a&&(o.beginPath(),o.moveTo(n,c+g),o.lineTo(n,c+d-g),o.quadraticCurveTo(n,c+d,n+g,c+d),o.lineTo(n+u-g,c+d),o.quadraticCurveTo(n+u,c+d,n+u,c+d-g),o.lineTo(n+u,c+g),o.quadraticCurveTo(n+u,c,n+u-g,c),o.lineTo(n+g,c),o.quadraticCurveTo(n,c,n,c+g),o.fill()),o.fillStyle=h,o.fillText(t.text,.5*l.width,l.height*(c/l.height+.1))})}.bind(this)};