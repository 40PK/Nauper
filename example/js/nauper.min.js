function Engine(e){function n(){a=Number(a)+1,a===e.length?canvas.removeEventListener("click",n):(e[a].draw(),"choice"===e[a].type&&(canvas.removeEventListener("click",n),canvas.addEventListener("click",t)))}function t(c){var i=c.pageY,r=3;i<.25*size.height?r=0:i<.5*size.height?r=1:i<.75*size.height&&(r=2),r<e[a].map.length&&(a=e[a].map[r].address,canvas.removeEventListener("click",t),canvas.addEventListener("click",n),e[a].draw())}var a=0;this.start=function(){return"frame"===e[0].type?canvas.addEventListener("click",n):"choice"===e[1].type&&canvas.addEventListener("click",t),e[0].draw(),!0}}
function Frame(e){function i(){render.fillStyle=a.base,render.fillRect(0,.8*size.height,size.width,.2*size.height),render.fillStyle=a.namecolor,render.font="15pt Arial",render.fillText(a.name,.1*size.width,.82*size.height),render.fillStyle=a.textcolor,render.fillText(a.text,.1*size.width,.85*size.height)}if(0===e.characters.length||0===e.displayOrder.length||!e.textbox||!e.background)throw new Error;var r=e.characters,t=e.displayOrder,a=e.textbox;this.type="frame",this.draw=function(){render.clearRect(0,0,size.width,size.height),canvas.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")",canvas.style.backgroundSize="cover",t.forEach(function(e,t){if(e!==!1||0===e){var a=new Image;a.onload=function(){var e,r=1.2*size.height/a.height,h=.1*size.height;0===t?e=0:1===t?e=.225*size.width:2===t?e=.45*size.width:3===t&&(e=.675*size.width),render.drawImage(a,e,h,a.width*r,a.height*r),i()},a.src=r[e]}})}}
function Character(n){if(n.path&&0!==n.emotions.length){var r={};return n.emotions.forEach(function(t){r[t]=n.path+"/"+t+".png"}),r}throw new Error}
function Question(e){if(!(0!==e.map.length&&1!==e.map.length&&e.map.length<5&&e.background&&e.boxcolor&&e.textcolor))throw new Error;this.map=e.map;var t=e.background,i=e.boxcolor;this.type="choice";var r=e.textcolor;this.draw=function(){render.fillStyle=t,render.fillRect(0,0,size.width,size.height),this.map.forEach(function(e,t){render.fillStyle=i,render.fillRect(0,.25*t*size.height,size.width,.25*size.height),render.fillStyle=r,render.fillText(e.text,.5*size.width,size.height*(.25*t+.125))})}}