function Engine(e){var n=0;nextElement=function(){n=Number(n)+1,n==e.length?canvas.removeEventListener("click",nextElement):(e[n].draw(),"choice"==e[n].type&&(canvas.removeEventListener("click",nextElement),canvas.addEventListener("click",choice)))},choice=function(t){var c=t.pageY,i=3;c<.25*size.height?i=0:c<.5*size.height?i=1:c<.75*size.height&&(i=2),i<e[n].map.length&&(n=e[n].map[i].address,canvas.removeEventListener("click",choice),canvas.addEventListener("click",nextElement),e[n].draw())},this.start=function(){return"frame"==e[0].type?canvas.addEventListener("click",nextElement):"choice"==e[1].type&&canvas.addEventListener("click",choice),e[0].draw(),!0}}
function Frame(e){function i(){render.fillStyle=a.base,render.fillRect(0,.8*size.height,size.width,.2*size.height),render.fillStyle=a.namecolor,render.font="15pt Arial",render.fillText(a.name,.1*size.width,.82*size.height),render.fillStyle=a.textcolor,render.fillText(a.text,.1*size.width,.85*size.height)}if(0==e.characters.length||0==e.displayOrder.length||!e.textbox||!e.background)throw new Error;var r=e.characters,t=e.displayOrder,a=e.textbox;this.type="frame",this.draw=function(){render.clearRect(0,0,size.width,size.height),canvas.style.backgroundImage="url(./data/images/backgrounds/"+e.background+")",canvas.style.backgroundSize="cover";t.forEach(function(e,t,a){if(0!=e||0==e){var h=new Image;h.onload=function(){var e=1.2*size.height/h.height,r=.1*size.height;if(0==t)var a=0;else if(1==t)var a=.225*size.width;else if(2==t)var a=.45*size.width;else if(3==t)var a=.675*size.width;render.drawImage(h,a,r,h.width*e,h.height*e),i()},h.src=r[e]}})}}
function Character(n){if(n.path&&0!=n.emotions.length){var r={};return n.emotions.forEach(function(t,o,a){r[t]=n.path+"/"+t+".png"}),r}throw new Error}
function Question(e){if(!(0!=e.map.length&&1!=e.map.length&&e.map.length<5&&e.background&&e.boxcolor&&e.textcolor))throw new Error;this.map=e.map;var t=e.background,i=e.boxcolor;this.type="choice";var r=e.textcolor;this.draw=function(){render.fillStyle=t,render.fillRect(0,0,size.width,size.height),this.map.forEach(function(e,t,l){render.fillStyle=i,render.fillRect(0,.25*t*size.height,size.width,.25*size.height),render.fillStyle=r,render.fillText(e.text,.5*size.width,size.height*(.25*t+.125))})}}