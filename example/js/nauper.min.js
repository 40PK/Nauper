function Engine(t){t=t||{},RESIZE.width=t.width||RESIZE.width,RESIZE.height=t.height||RESIZE.height,TITLE=t.title||TITLE}function DialogsSystem(t){t=t||[],this.map=t}function DialogSystem(t){t=t||{},t.type=t.type||"dialog",t.heroes=t.heroes||[],this.map=t}function HeroesSystem(){}function HeroSystem(t){var t=t||{};this.map={name:t.name||"Nauper",position:{x:0,y:0},size:{width:50,height:120}}}function EmotionsSystem(){this.emotions={}}function EmotionSystem(){this.emotion=new Image}function wrapText(t,e,i,o,n,s){for(var h=e.split(" "),r="",E=0;E<h.length;E++){var a=r+h[E]+" ",p=t.measureText(a),m=p.width;m>n&&E>0?(t.fillText(r,i,o),r=h[E]+" ",o+=s):r=a}t.fillText(r,i,o)}var CANVAS=document.getElementsByTagName("canvas")[0];CANVAS.width=CANVAS.width||800,CANVAS.height=CANVAS.height||600;var TITLE="Nauper",RESIZE={width:CANVAS.width,height:CANVAS.height},RENDER=CANVAS.getContext("2d"),SCENE=-1,DIALOGS=[],HEROES=[],COVER=new Image;COVER.src="http://localhost:8000/data/backgrounds/1.jpg",Engine.prototype.setSize=function(t,e){return RESIZE.width=t,RESIZE.height=e,this},Engine.prototype.setTitle=function(t){return TITLE=t,this},Engine.prototype.setDialogs=function(t){DIALOGS=t},Engine.prototype.nextScene=function(){if(RENDER.clearRect(0,0,this.width,this.height),SCENE>DIALOGS.length-1&&(SCENE=-1),SCENE<0)RENDER.drawImage(COVER,0,0,this.width,this.height),RENDER.font="23px verdana",RENDER.fillStyle="black",RENDER.fillText(TITLE,50,100);else{var t=DIALOGS[SCENE];if(RENDER.drawImage(t.background,0,0,this.width,this.height),t.heroes.length>0){var e;for(e=0;e<t.heroes.length;e++){var i=t.heroes[e].split(":");i[0]=+i[0],RENDER.drawImage(HEROES[i[0]].emotion[i[1]],HEROES[i[0]].position.x,HEROES[i[0]].position.y,HEROES[i[0]].size.width,HEROES[i[0]].size.height)}}"dialog"===t.type&&(RENDER.fillStyle="white",RENDER.fillRect(30,this.height-150,this.width-60,140),RENDER.font="16px verdana",RENDER.fillStyle="black",t.author>=0?(RENDER.fillText(HEROES[t.author].name+":",50,this.height-125),wrapText(RENDER,t.text,50,this.height-100,this.width-100,20)):RENDER.fillText(t.text,50,this.height-125))}SCENE+=1},Engine.prototype.run=function(){document.getElementsByTagName("title")[0].innerHTML=TITLE,CANVAS.width=RESIZE.width,CANVAS.height=RESIZE.height,RENDER.font="18px verdana",RENDER.fillText("Nauper Engine",50,RESIZE.height-50),CANVAS.addEventListener("click",this.nextScene)},DialogsSystem.prototype.add=function(t){return this.map.push(t.map),this},DialogsSystem.prototype.get=function(t){return t=+t||0,this.map[t]},DialogsSystem.prototype.getLength=function(){return this.map.length-1},DialogSystem.prototype.setText=function(t){return this.map.text=t,this},DialogSystem.prototype.setAuthor=function(t){return this.map.author=t,this},DialogSystem.prototype.setBackground=function(t){return this.map.background=new Image,this.map.background.src=t,this},DialogSystem.prototype.setHeroes=function(t){return this.map.heroes=t,this},DialogSystem.prototype.addHero=function(t){return this.map.heroes.push(t),this},HeroesSystem.prototype.add=function(t){HEROES.push(t.map)},HeroesSystem.prototype.remove=function(t){delete HEROES[t]},HeroSystem.prototype.setName=function(t){return this.map.name=t,this},HeroSystem.prototype.setPosition=function(t,e){return this.map.position.x=t,this.map.position.y=e,this},HeroSystem.prototype.setSize=function(t,e){return t=t||50,e=e||120,this.map.size.width=t,this.map.size.height=e,this},HeroSystem.prototype.setEmotions=function(t){return this.map.emotion=t.emotions,this},HeroSystem.prototype.addEmotion=function(t){return this.map.emotion.push(t.emotion),this},HeroSystem.prototype.activeEmotion=function(t){return this.map.active=t,this},EmotionsSystem.prototype.add=function(t,e){return this.emotions[t]=e.emotion,this},EmotionsSystem.prototype.remove=function(t){return delete this.emotions[t],this},EmotionSystem.prototype.setImage=function(t){return this.emotion.src=t,this};