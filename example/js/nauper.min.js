"use strict";var Nauper={version:"0.1"};
"use strict";var getTextHeight=function(t){var e=document.createElement("p"),n=0;return e.style.font=t,e.style.position="relative",e.style.zIndex="-1",e.innerHTML="Test",document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e),n},wrapText=function(t,e,n,i){var u=e.split(" "),r="",o=getTextHeight(n),c=0,d=[];return u.forEach(function(e,n){c=""===r?t.measureText(e).width:t.measureText(r+" "+e).width,c>i?(d.push(r),r=e):c===i?(d.push(r+" "+e),r=""):c<i&&(r=r?r+" "+e:e,n+1===u.length&&d.push(r))}),{result:d,height:o}},getTextOffset=function(t,e,n){var i=t.measureText(n).width,u=.5*e.width,r=.5*i,o=u-r;return o},putDefaults=function(t,e){var n=Object.getOwnPropertyNames(t),i={};return n.forEach(function(n){void 0===e[n]?i[n]=t[n]:void 0!==e[n]&&(i[n]=e[n])}),i},copyObject=function(t){var e={};return e=putDefaults(t,{})},getWindowSize=function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}};
"use strict";Nauper.UI=function(e){this.engine=e,this.canvas=this.engine.canvas,this.render=this.engine.render,this.size=this.engine.size},Nauper.UI.prototype.setBackground=function(e){e&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+e+")")},Nauper.UI.prototype.drawTextBox=function(e){var t=this,i={type:"default",color:"#fff",link:"",x:.025,y:.8,height:.18,width:.95,radius:.05,callback:function(){}},r=putDefaults(i,e),n=this.size.width*r.x,a=this.size.height*r.y,s=this.size.height*r.height,h=this.size.width*r.width,d=this.size.height*r.radius;this.render.fillStyle=r.color,"default"===r.type?this.render.fillRect(n,a,h,s):"rounded"===r.type?(this.render.beginPath(),this.render.moveTo(n,a+d),this.render.lineTo(n,a+s-d),this.render.quadraticCurveTo(n,a+s,n+d,a+s),this.render.lineTo(n+h-d,a+s),this.render.quadraticCurveTo(n+h,a+s,n+h,a+s-d),this.render.lineTo(n+h,a+d),this.render.quadraticCurveTo(n+h,a,n+h-d,a),this.render.lineTo(n+d,a),this.render.quadraticCurveTo(n,a,n,a+d),this.render.fill()):"image"===r.type&&!function(){var e=new Image;e.addEventListener("load",function(i){t.render.drawImage(e,n,a,h,s),r.callback&&r.callback(i)}),e.src=r.link}(),"image"!==r.type&&r.callback()},Nauper.UI.prototype.drawText=function(e){var t=this,i={text:"",align:"wrapped",color:"#000",x:.1,y:.85,width:.8},r=putDefaults(i,e),n=this.size.width*r.x,a=this.size.height*r.y,s=this.size.width*r.width;if(this.render.fillStyle=r.color,"wrapped"===r.align)!function(){var e=wrapText(t.render,r.text,t.render.font,s);e.result.forEach(function(i,r){t.render.fillText(i,n,a+e.height*r)})}();else if("center"===r.align){var h=getTextOffset(this.render,{width:this.canvas.width},r.text);this.render.fillText(r.text,h,a)}},Nauper.UI.prototype.process=function(e){var t=void 0;return e&&(t="next"),t},Nauper.UI.prototype.move=function(e){console.log("X: "+e.pageX+" Y: "+e.pageY)};
"use strict";Nauper.Sound=function(t){this.engine=t,this.audio=this.engine.audio,this.repeating=!1,this.repeatend=function(){this.audio.play(),this.repeating=!0}.bind(this),this.stopend=function e(){this.stop(),this.audio.removeEventListener("ended",e)}.bind(this)},Nauper.Sound.prototype.play=function(t,e){this.audio.src="./data/sounds/"+t,this.audio.play(),e?this.audio.addEventListener("ended",this.stopend):e||this.audio.addEventListener("ended",this.repeatend)},Nauper.Sound.prototype.pause=function(){this.audio.pause()},Nauper.Sound.prototype.stop=function(){this.pause(),this.repeating&&(this.audio.removeEventListener("ended",this.repeatend),this.repeating=!1),this.audio.src=""},Nauper.Sound.prototype.process=function(t,e){void 0!==t&&(this.stop(),t&&this.play(t,e))};
"use strict";Nauper.Engine=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.font=e.font,this.audio=document.getElementById("audio"),this.canvas=document.getElementById("canvas"),this.render=this.canvas.getContext("2d"),this.size=getWindowSize(),this.ui=new Nauper.UI(this),this.sound=new Nauper.Sound(this),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=this.font,this.element=null,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.elementProcessor=function(e){var t=this.ui.process(e);"redraw"===t?this.element.draw():"next"===t&&(this.click(e),this.sound.process(this.element.audio,this.element.once))}.bind(this),this.resize=function(){this.size=getWindowSize(),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.elements[this.globalIndex][this.localIndex].draw()}.bind(this),this.move=function(e){this.ui.move(e)}.bind(this),this.canvas.addEventListener("click",this.elementProcessor,!1),window.addEventListener("resize",this.resize,!1),window.addEventListener("mousemove",this.move,!1)},Nauper.Engine.prototype.click=function(e){this.clickType&&this[this.clickType].call(this,e)},Nauper.Engine.prototype.choice=function(e){var t=this,i=e.pageX,s=e.pageY;this.element.map.forEach(function(e,n){var h={x:.025*t.size.width,y:(.25*n+.025)*t.size.height,height:.2*t.size.height,width:.95*t.size.width};i>=h.x&&i<=h.x+h.width&&s>=h.y&&s<=h.y+h.height&&(e.address!==!1&&(t.globalIndex=e.address,t.localIndex=-1),t.nextElement())})},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.element=this.elements[this.globalIndex][this.localIndex],this.element.draw.call(null,this),"choice"===this.element.type&&(this.element.necessary||void 0===this.element.necessary)?this.clickType="choice":this.clickType="nextElement")},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(t,e){this.engine=t,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=e.characters,this.displayOrder=e.displayOrder,this.background=e.background,this.text=e.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.setText=function(){var t=this;void 0!==this.text&&this.engine.ui.drawTextBox({type:this.text.type,color:this.text.background,link:this.text.link,callback:function(){t.engine.ui.drawText({text:t.text.name,color:t.text.ncl,x:.1,y:.83}),t.engine.ui.drawText({text:t.text.text,color:t.text.color,x:.1,y:.86})}})},Nauper.Frame.prototype.displayCharacters=function(){var t=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){for(var e=t.displayOrder.length,i=function(i){var r=t.displayOrder[i];r!==!1&&void 0!==r?!function(){var n=new Image;n.onload=function(){var r=1.2*t.size.height/n.height,s=.1*t.size.height,a=t.size.width*(.225*i);t.render.drawImage(n,a,s,n.width*r,n.height*r),e-=1,0===e&&t.setText()},n.src=t.characters[r]}():e-=1},r=0;r<t.displayOrder.length;r+=1)i(r)}():this.setText()};
"use strict";Nauper.Question=function(t,i){this.background=i.background,this.activebox=i.textbox.active,this.inactivebox=i.textbox.inactive,this.boxtype=i.textbox.type,this.boxlink=i.textbox.link,this.type="choice",this.necessary=i.necessary,this.engine=t,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=i.map,this.draw=function(){var t=this;if(0!==this.map.length&&this.map.length<=4){var i=.025,e=.2,n=.95,s=.05;this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background);for(var h=function(h){var a=t.map[h];t.engine.ui.drawTextBox({type:t.boxtype,color:t.inactivebox.background,link:t.boxlink,y:.25*h+.025,x:i,height:e,width:n,radius:s,callback:function(){t.engine.ui.drawText({text:a.text,align:"center",color:t.inactivebox.text,y:.25*h+.125})}})},a=0;a<this.map.length;a+=1)h(a)}else this.engine.nextElement()}.bind(this)};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};