"use strict";var Nauper={version:"0.1"};
"use strict";var getTextHeight=function(t){var e=document.createElement("p"),n=0;return e.style.font=t,e.style.position="relative",e.style.zIndex="-1",e.innerHTML="Test",document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e),n},wrapText=function(t,e,n,r){var u=e.split(" "),i="",o=getTextHeight(n),s=0,a=[];return u.forEach(function(e,n){s=""===i?t.measureText(e).width:t.measureText(i+" "+e).width,s>r?(a.push(i),i=e):s===r?(a.push(i+" "+e),i=""):s<r&&(i=i?i+" "+e:e,n+1===u.length&&a.push(i))}),{result:a,height:o}},getTextOffset=function(t,e,n){var r=t.measureText(n).width,u=.5*e.width,i=.5*r,o=u-i;return o},putDefaults=function(t,e){var n=Object.getOwnPropertyNames(t),r={};return n.forEach(function(n){void 0===e[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])}),r},copyObject=function(t){var e={};return e=putDefaults(t,{})};
"use strict";Nauper.UI=function(e){this.engine=e,this.canvas=this.engine.canvas,this.render=this.engine.render,this.size=this.engine.size},Nauper.UI.prototype.setBackground=function(e){e&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+e+")")},Nauper.UI.prototype.drawTextBox=function(e){var t=this,i={type:"default",color:"#fff",link:"",x:.025,y:.8,height:.18,width:.95,radius:.05,callback:function(){}},r=putDefaults(i,e),n=this.size.width*r.x,s=this.size.height*r.y,a=this.size.height*r.height,h=this.size.width*r.width,d=this.size.height*r.radius;this.render.fillStyle=r.color,"default"===r.type?this.render.fillRect(n,s,h,a):"rounded"===r.type?(this.render.beginPath(),this.render.moveTo(n,s+d),this.render.lineTo(n,s+a-d),this.render.quadraticCurveTo(n,s+a,n+d,s+a),this.render.lineTo(n+h-d,s+a),this.render.quadraticCurveTo(n+h,s+a,n+h,s+a-d),this.render.lineTo(n+h,s+d),this.render.quadraticCurveTo(n+h,s,n+h-d,s),this.render.lineTo(n+d,s),this.render.quadraticCurveTo(n,s,n,s+d),this.render.fill()):"image"===r.type&&!function(){var e=new Image;e.addEventListener("load",function(i){t.render.drawImage(e,n,s,h,a),r.callback&&r.callback(i)}),e.src=r.link}(),"image"!==r.type&&r.callback()},Nauper.UI.prototype.drawText=function(e){var t=this,i={text:"",align:"wrapped",color:"#000",x:.1,y:.85,width:.8},r=putDefaults(i,e),n=this.size.width*r.x,s=this.size.height*r.y,a=this.size.width*r.width;if(this.render.fillStyle=r.color,"wrapped"===r.align)!function(){var e=wrapText(t.render,r.text,t.render.font,a);e.result.forEach(function(i,r){t.render.fillText(i,n,s+e.height*r)})}();else if("center"===r.align){var h=getTextOffset(this.render,{width:this.canvas.width},r.text);this.render.fillText(r.text,h,s)}},Nauper.UI.prototype.process=function(e){var t=void 0;return e&&(t="next"),t};
"use strict";Nauper.Sound=function(o){this.engine=o,this.audio=this.engine.audio},Nauper.Sound.prototype.play=function(o){this.audio.src="./data/sounds/"+o,this.audio.play()},Nauper.Sound.prototype.pause=function(){this.audio.pause()},Nauper.Sound.prototype.stop=function(){this.pause(),this.audio.src=""},Nauper.Sound.prototype.process=function(o){void 0!==o&&(this.stop(),o&&this.play(o))};
"use strict";Nauper.Engine=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.font=e.font,this.audio=document.getElementById("audio"),this.canvas=document.getElementById("canvas"),this.render=this.canvas.getContext("2d"),this.size={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},this.ui=new Nauper.UI(this),this.sound=new Nauper.Sound(this),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=this.font,this.elements=t,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.elementProcessor=function(e){var t=this.ui.process(e);"redraw"===t?this.elements[this.globalIndex][this.localIndex].draw():"next"===t&&(this.click(e),this.sound.process(this.elements[this.globalIndex][this.localIndex].audio))}.bind(this),this.canvas.addEventListener("click",this.elementProcessor,!1)},Nauper.Engine.prototype.click=function(e){this.clickType&&this[this.clickType].call(this,e)},Nauper.Engine.prototype.choice=function(e){var t=this,i=e.pageX,n=e.pageY;this.elements[this.globalIndex][this.localIndex].map.forEach(function(e,s){var h={x:.025*t.size.width,y:(.25*s+.025)*t.size.height,height:.2*t.size.height,width:.95*t.size.width};i>=h.x&&i<=h.x+h.width&&n>=h.y&&n<=h.y+h.height&&(e.address!==!1&&(t.globalIndex=e.address,t.localIndex=-1),t.nextElement())})},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType="nextElement")},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(t,e){this.engine=t,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=e.characters,this.displayOrder=e.displayOrder,this.background=e.background,this.text=e.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.setText=function(){var t=this;void 0!==this.text&&this.engine.ui.drawTextBox({type:this.text.type,color:this.text.background,link:this.text.link,callback:function(){t.engine.ui.drawText({text:t.text.name,color:t.text.ncl,x:.1,y:.83}),t.engine.ui.drawText({text:t.text.text,color:t.text.color,x:.1,y:.86})}})},Nauper.Frame.prototype.displayCharacters=function(){var t=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){for(var e=t.displayOrder.length,i=function(i){var r=t.displayOrder[i];r!==!1&&void 0!==r?!function(){var n=new Image;n.onload=function(){var r=1.2*t.size.height/n.height,s=.1*t.size.height,a=t.size.width*(.225*i);t.render.drawImage(n,a,s,n.width*r,n.height*r),e-=1,0===e&&t.setText()},n.src=t.characters[r]}():e-=1},r=0;r<t.displayOrder.length;r+=1)i(r)}():this.setText()};
"use strict";Nauper.Question=function(t,e){this.background=e.background,this.activebox=e.textbox.active,this.inactivebox=e.textbox.inactive,this.boxtype=e.textbox.type,this.boxlink=e.textbox.link,this.necessary=e.necessary,this.engine=t,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=e.map,this.setType(),this.draw=function(){var t=this;if(0!==this.map.length&&this.map.length<=4){var e=.025,i=.2,n=.95,s=.05;this.render.clearRect(0,0,this.size.width,this.size.height),this.engine.ui.setBackground(this.background);for(var h=function(h){var a=t.map[h];t.engine.ui.drawTextBox({type:t.boxtype,color:t.inactivebox.background,link:t.boxlink,y:.25*h+.025,x:e,height:i,width:n,radius:s,callback:function(){t.engine.ui.drawText({text:a.text,align:"center",color:t.inactivebox.text,y:.25*h+.125})}})},a=0;a<this.map.length;a+=1)h(a)}else this.engine.nextElement()}.bind(this)},Nauper.Question.prototype.setType=function(){this.necessary===!0||void 0===this.necessary?this.type="choice":this.type="frame"};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};