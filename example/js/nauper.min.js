"use strict";var Nauper={version:"0.1"};
"use strict";var wrapText=function(e,t,n,r){var s=document.createElement("p"),i=t.split(" "),d="",o=0,u=0,h=[];return s.style.font=n,s.style.position="relative",s.style.zIndex="-1",s.innerHTML="Test",document.body.appendChild(s),o=s.offsetHeight,document.body.removeChild(s),i.forEach(function(t,n){u=""===d?e.render.measureText(t).width:e.render.measureText(d+" "+t).width,u>r?(h.push(d),d=t):u===r?(h.push(d+" "+t),d=""):u<r&&(d=d?d+" "+t:t,n+1===i.length&&h.push(d))}),{result:h,height:o}};
"use strict";Nauper.Engine=function(e){function t(e){this.clickType&&this[this.clickType].call(this,e)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.canvas=e.canvas,this.render=this.canvas.getContext("2d"),this.size=e.size,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.render.font=e.font,this.elements=i,this.globalIndex=0,this.localIndex=0,this.clickType=null,this.canvas.addEventListener("click",t.bind(this),!1)},Nauper.Engine.prototype.choice=function(e){var t=e.pageY,i=3;t<.25*this.size.height?i=0:t<.5*this.size.height?i=1:t<.75*this.size.height&&(i=2),i<this.elements[this.globalIndex][this.localIndex].map.length&&(this.globalIndex=this.elements[this.globalIndex][this.localIndex].map[i].address,this.localIndex=0,this.clickType="nextElement",this.elements[this.globalIndex][this.localIndex].draw.call(null,this))},Nauper.Engine.prototype.nextElement=function(){this.localIndex=Number(this.localIndex)+1,this.localIndex===this.elements[this.globalIndex].length?this.clickType=null:(this.elements[this.globalIndex][this.localIndex].draw.call(null,this),"choice"===this.elements[this.globalIndex][this.localIndex].type?this.clickType="choice":this.clickType=this.clickType)},Nauper.Engine.prototype.start=function(){return"frame"===this.elements[0][0].type?this.clickType="nextElement":"choice"===this.elements[0][0].type&&(this.clickType="choice"),this.elements[0][0].draw.call(null,this),!0},Nauper.Engine.prototype.addScene=function(e){this.elements.push(e)};
"use strict";Nauper.Frame=function(e,t){this.engine=e,this.render=this.engine.render,this.size=this.engine.size,this.canvas=this.engine.canvas,this.characters=t.characters,this.displayOrder=t.displayOrder,this.background=t.background,this.text=t.textbox,this.type="frame",this.draw=function(){this.check()?(this.render.clearRect(0,0,this.size.width,this.size.height),this.setBackground(),this.displayCharacters()):this.engine.nextElement()}.bind(this)},Nauper.Frame.prototype.setBackground=function(){this.background&&(this.canvas.style.backgroundImage="url(./data/images/backgrounds/"+this.background+")")},Nauper.Frame.prototype.check=function(){return!0},Nauper.Frame.prototype.setText=function(){if(void 0!==this.text){var e=.025*this.size.width,t=.8*this.size.height,i=.18*this.size.height,r=.95*this.size.width,s=.05*this.size.height,h=.8*this.size.width,n=.1*this.size.width,a=.83*this.size.height+27,d=[];this.render.fillStyle=this.text.base,"default"===this.text.edges?this.render.fillRect(e,t,r,i):"rounded"===this.text.edges&&(this.render.beginPath(),this.render.moveTo(e,t+s),this.render.lineTo(e,t+i-s),this.render.quadraticCurveTo(e,t+i,e+s,t+i),this.render.lineTo(e+r-s,t+i),this.render.quadraticCurveTo(e+r,t+i,e+r,t+i-s),this.render.lineTo(e+r,t+s),this.render.quadraticCurveTo(e+r,t,e+r-s,t),this.render.lineTo(e+s,t),this.render.quadraticCurveTo(e,t,e,t+s),this.render.fill()),this.render.fillStyle=this.text.namecolor,this.render.fillText(this.text.name,.1*this.size.width,t+27),this.render.fillStyle=this.text.textcolor,d=wrapText(this.engine,this.text.text,this.render.font,h);for(var o=0;o<d.result.length;o+=1){var c=d.result[o];this.render.fillText(c,n,a+d.height*o)}}},Nauper.Frame.prototype.displayCharacters=function(){var e=this;void 0!==this.displayOrder&&0!==this.displayOrder.length?!function(){var t=e.displayOrder.length;e.displayOrder.forEach(function(i,r){i!==!1&&void 0!==i?!function(){var s=new Image;s.addEventListener("load",function(){var i=1.2*e.size.height/s.height,h=.1*e.size.height,n=e.size.width*(.225*r);e.render.drawImage(s,n,h,s.width*i,s.height*i),t-=1,0===t&&e.setText()}),s.src=e.characters[i]}():t-=1})}():this.setText()};
"use strict";Nauper.Question=function(e,t){this.background=t.background,this.activebox=t.textbox.active,this.inactivebox=t.textbox.inactive,this.boxtype=t.textbox.type,this.necessary=t.necessary,this.engine=e,this.render=this.engine.render,this.canvas=this.engine.canvas,this.size=this.engine.size,this.map=t.map,this.setType(),this.draw=function(){var e=this;0!==this.map.length&&this.map.length<=4?!function(){var t=.025*e.size.width,i=0,h=.2*e.size.height,s=.95*e.size.width,r=.05*e.size.height;e.render.clearRect(0,0,e.size.width,e.size.height),e.setBackground(),e.map.forEach(function(n,a){i=(.25*a+.025)*e.size.height,e.renderBox(a,!1,{x:t,y:i,height:h,width:s,radius:r})})}():this.engine.nextElement()}.bind(this)},Nauper.Question.prototype.setBackground=function(){this.background&&(this.canvas.style.backgroundImage='url("./data/images/backgrounds/'+this.background+'")')},Nauper.Question.prototype.setType=function(){this.necessary===!0||void 0===this.necessary?this.type="choice":this.type="frame"},Nauper.Question.prototype.setText=function(e,t,i){var h=.5*this.size.width-this.render.measureText(this.map[e].text).width/2,s=this.size.height*(i.y/this.size.height+.1);t?this.render.fillStyle=this.activebox.text:t||(this.render.fillStyle=this.inactivebox.text),this.render.fillText(this.map[e].text,h,s)},Nauper.Question.prototype.renderBox=function(e,t,i){var h={xwidth:i.x+i.width,yheight:i.y+i.height};t?this.render.fillStyle=this.activebox.background:t||(this.render.fillStyle=this.inactivebox.background),"default"===this.boxtype?this.render.fillRect(i.x,i.y,i.width,i.height):"rounded"===this.boxtype&&(this.render.beginPath(),this.render.moveTo(i.x,i.y+i.radius),this.render.lineTo(i.x,h.yheight-i.radius),this.render.quadraticCurveTo(i.x,h.yheight,i.x+i.radius,h.yheight),this.render.lineTo(h.xwidth-i.radius,h.yheight),this.render.quadraticCurveTo(h.xwidth,h.yheight,h.xwidth,h.yheight-i.radius),this.render.lineTo(h.xwidth,i.y+i.radius),this.render.quadraticCurveTo(h.xwidth,i.y,h.xwidth-i.radius,i.y),this.render.lineTo(i.x+i.radius,i.y),this.render.quadraticCurveTo(i.x,i.y,i.x,i.y+i.radius),this.render.fill()),this.setText(e,t,i)};
"use strict";Nauper.Character=function(r){var t={};return r.emotions.forEach(function(n){t[n]=r.path+"/"+n+".png"}),t};